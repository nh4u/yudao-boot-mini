<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.bitlinks.ems.module.power.dal.mysql.standingbook.attribute.StandingbookAttributeMapper">

    <!--
        一般情况下，尽可能使用 Mapper 进行 CRUD 增删改查即可。
        无法满足的场景，例如说多表关联查询，才使用 XML 编写 SQL。
        代码生成器暂时只生成 Mapper XML 文件本身，更多推荐 MybatisX 快速开发插件来生成查询。
        文档可见：https://www.bitlinks.cn/MyBatis/x-plugins/
     -->

    <select id="selectStandingbook" parameterType="java.util.List"  resultType="cn.bitlinks.ems.module.power.dal.dataobject.standingbook.StandingbookDO">
        SELECT standingbook.id,standingbook.update_time FROM power_standingbook standingbook LEFT JOIN (SELECT * FROM power_standingbook_attribute
        <where>
            deleted = 0
            <if test="list!= null and list.size > 0">
                AND (
                <foreach collection="list" item="item"  separator="OR" >
                       `value` LIKE   CONCAT('%', #{item.value},'%')
                </foreach>)
                AND `code` IN
                <foreach collection="list" item="item" open="(" separator="," close=")">
                    #{item.code}
                </foreach>
            </if>
        </where>
        ) standingbookattribute ON standingbook.id = standingbookattribute.standingbook_id
        <where>
            standingbook.deleted = 0
            <if test="typeId!= null">
                AND standingbook.type_id = #{typeId}
            </if>
            AND standingbookattribute.id  IS NOT NULL
        </where>
        GROUP BY standingbook.id,standingbook.update_time
        ORDER BY standingbook.update_time DESC

    </select>

</mapper>
